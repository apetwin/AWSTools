{
  "schemaVersion": "2.2",
  "description": "Fix Windows Vulnerabilities",
  "mainSteps": [
    {
      "action": "aws:runPowerShellScript",
      "name": "fix_ciphers",
      "inputs": {
        "runCommand": [
          "Disable-TlsCipherSuite -Name \"TLS_RSA_WITH_3DES_EDE_CBC_SHA\"",
          "Disable-TlsCipherSuite -Name \"TLS_RSA_WITH_AES_128_CBC_SHA\"",
          "Disable-TlsCipherSuite -Name \"TLS_RSA_WITH_RC4_128_MD5\"",
          "Disable-TlsCipherSuite -Name \"TLS_RSA_WITH_RC4_128_SHA\"",
          "Disable-TlsCipherSuite -Name \"TLS_RSA_WITH_AES_128_CBC_SHA256\"",
          "Disable-TlsCipherSuite -Name \"TLS_RSA_WITH_AES_128_GCM_SHA256\"",
          "Disable-TlsCipherSuite -Name \"TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\"",
          "Disable-TlsCipherSuite -Name \"TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\"",
          "Disable-TlsCipherSuite -Name \"TLS_DHE_RSA_WITH_AES_256_CBC_SHA\"",
          "Disable-TlsCipherSuite -Name \"TLS_DHE_RSA_WITH_AES_128_CBC_SHA\"",
          "Disable-TlsCipherSuite -Name \"TLS_RSA_WITH_AES_256_CBC_SHA\""
        ]
      }
    },
    {
      "action": "aws:runPowerShellScript",
      "name": "fix_other_vulnerabilities",
      "inputs": {
        "runCommand": [
          "Add-WebConfigurationProperty -Filter system-webServer/security/requestFiltering -Name verbs -Value @{verb='OPTIONS';allowed='False'}",
          "Set-DnsServerRecursion -Enable $false",
          "Remove-WebConfigurationProperty -Filter /system-webServer/defaultDocument -Name files -AtElement @{value=\"iisstart-htm\"}",
          "Set-ItemProperty -Path \"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters\" -Name \"requiresecuritysignature\" -Value 1 -Force",
          "Set-ItemProperty -Path HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanManServer\\Parameters -Name \"enablesecuritysignature\" -Value 1 -Force",
          "netsh advfirewall firewall add rule name=\"Block Type 13 ICMP V4\" protocol=icmpv4:13,any dir=in action=block"
          "netsh advfirewall firewall add rule name=\"Block Type 14 ICMP V4\" protocol=icmpv4:8,any dir=in action=block"
          "Disable-WindowsOptionalFeature -Online -FeatureName SMB1Protocol -NoRestart"
        ]
      }
    }
  ]
}